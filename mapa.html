<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Desafio Menu</title>
    <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
    <link href="./fontAwesome/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel='stylesheet'>
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/font-awesome.min.css">
</head>

<body>
    <header class="cabecalho">
        <div class="logo">
            <a href="https://google.com.br"><img class=logo src="images/metroLogo.png"></a>
        </div>
        <nav class="menu">
            <ul>
                <li>
                    <a href="index.html">Início</a>
                </li>
                <li>
                    <a href mnavConsulta="consulta.html">Simulador</a>
                </li>
                <li>
                    <a href="#sobre">Estações</a>
                </li>
                <li>
                    <a href="mapa.html">Mapa</a>
                </li>
            </ul>
        </nav>
        <div class="autenticacao">
            <a href="https://api.whatsapp.com/send?phone=5561995720279&text=Suporte%20Metro%20Bras%C3%ADlia"><i
                    class="fa-brands fa-whatsapp"></i></a>
        </div>
    </header>


    <section id="teste">
<i class="fa-solid fa-map-location-dot"></i>
<div class="mapadiv">
    <div class="estacoes">
        <ul>
            <li><i class="fa-solid fa-circle-check"></i>Estação Central</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Galeria</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação 102 Sul</li>
            <li><i class="fa-solid fa-circle-xmark"></i>Estação 104 Sul</li>
            <li><i class="fa-solid fa-circle-xmark"></i>Estação 106 Sul</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação 108 Sul</li>
            <li><i class="fa-solid fa-circle-xmark"></i>Estação 110 Sul</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação 112 Sul</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação 114 Sul</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Asa Sul</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Feira</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Guará</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Arniqueiras</li>
        </ul>
        </div>
        <div class="estacoes2">
        <ul>
            <li><i class="fa-solid fa-circle-check"></i>Estação Aguas Claras</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Concessionárias</li>
            <li><i class="fa-solid fa-circle-xmark"></i>Estação Estrada Parque</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Praça do Relógio</li>
            <li><i class="fa-solid fa-circle-xmark"></i>Estação Onoyama</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Centro Metropolitano</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Ceilândia Sul</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Guariroba</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Ceilandia Centro</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Ceilândia Norte</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Terminal Ceilândia</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Taguatinga Sul</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Furnas</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Samambaia Sul</li>
            <li><i class="fa-solid fa-circle-check"></i>Estação Terminal Samambaia</li>

        </ul>
    </div>
<img class="mapa" src="images/brasilia-metro-map.jpg">
</div>

    </section>

    <script>
        const resultado1 = document.createElement( 'div' )
        resultado1.classList.add( 'painel' )
        const resultado2 = document.createElement( 'div' )
        resultado2.classList.add('consulta')
        const section = document.querySelector( 'section' )
        const body = document.querySelector('body')
        document.querySelectorAll( '[mnavConsulta]' ).forEach( link => {
            const conteudo = document.getElementById( 'teste' )

            link.onclick = function ( e ) {
                e.preventDefault()
                fetch( link.getAttribute( 'mnavConsulta' ) )
                    .then( resp => resp.text() )
                    .then( html => conteudo.innerHTML = html )
                    .then( () => {
                        const submit = document.querySelector( '[mSubmit]' )
                        submit.onclick = function ( e ) {
                            e.preventDefault()
                            const form = e.target.parentNode
                            const formData = new FormData( form )
                            const estacaoUmFromForm = formData.get( 'estacoesUm' )
                            const estacaoDoisFromForm = formData.get( 'estacoesDois' )
                            console.log( estacaoUmFromForm )
                            console.log( estacaoDoisFromForm )



                            function simulador( estacao1, estacao2 ) {

                                // Array com as estações do METRO DF e respectivos tempos de chegada em segundos (tempo real médio) a partir da estação central
                                // Exemplo: na estação 'sul102' temos o número 210 que significa quantos segundos em média ela está distante da estação central
                                const estacoes = {
                                    estCentral: ['Estação Central', 0],
                                    estGaleria: ['Estação Galeria', 105],
                                    sul102: ['Estação 102 Sul', 210],
                                    sul108: ['Estação 108 Sul', 450],
                                    sul112: ['Estação 112 Sul', 610],
                                    sul114: ['Estação 114 Sul', 700],
                                    asaSul: ['Estação Asa Sul', 830],
                                    estShop: ['Estação Shopping', 990],
                                    estFeira: ['Estação Feira', 1185],
                                    estGuara: ['Estação Guará', 1285],
                                    estArni: ['Estação Arniqueiras', 1555],
                                    estAguas: ['Estação Aguas Claras', 1680],

                                    estConce: ['Estação Concessionárias', 1805],
                                    estRelogio: ['Estação Praça do Relógio', 1980],
                                    estMetropol: ['Estação Centro Metropolitano', 2240],
                                    estCeiSul: ['Estação Ceilandia Sul', 2405],
                                    estGuari: ['Estação Guariroba', 2500],
                                    ceiCentro: ['Estação Ceilândia Centro', 2595],
                                    ceiNorte: ['Estação Ceilândia Norte', 2690],
                                    estCei: ['Estação Ceilândia', 2845],

                                    estTagua: ['Estação Taguatinga', 1835],
                                    estFurnas: ['Estação Furnas', 2005],
                                    estSamSul: ['Estação Samambaia Sul', 2130],
                                    estSamTermi: ['Estação Terminal Samambaia', 2260]
                                }





                                if ( ( Object.values( estacoes )[estacao1] ) && Object.values( estacoes )[estacao2] ) {
                                    const primeiraEstacao = Object.values( estacoes )[estacao1]
                                    const segundaEstacao = Object.values( estacoes )[estacao2]

                                    const horasPrimeira = primeiraEstacao[1]
                                    const horasSegunda = segundaEstacao[1]

                                    if ( horasPrimeira > horasSegunda ) {
                                        return ( horasPrimeira - horasSegunda )
                                    }
                                    else if ( horasSegunda - horasPrimeira ) {
                                        return horasSegunda - horasPrimeira
                                    }
                                    else { return '0' }

                                }

                            }
                            function toHoursAndMinutes( totalMinutes ) {
                                const minutes = totalMinutes % 60;
                                const hours = Math.floor( totalMinutes / 60 );
                                       
                                
                                       if (((estacaoDoisFromForm) != null) && ((estacaoUmFromForm) != null)) {
                                return `Duração de aproximadamente ${padTo2Digits( hours )} minutos e ${padTo2Digits( minutes )} segundos`;}
                                        else return "Insira sua estação de entrada e sua estação de saída!"
                            }

                            function padTo2Digits( num ) {
                                return num.toString().padStart( 2, '0' );
                            }

                            console.log( toHoursAndMinutes( simulador( estacaoUmFromForm, estacaoDoisFromForm ) ) )
                            resultado2.innerHTML = toHoursAndMinutes( simulador( estacaoUmFromForm, estacaoDoisFromForm ) )

                            if (document.querySelector('resultado2')){
                            body.removeChild(resultado2)
                            body.appendChild( resultado2 )
                        }
                            else body.appendChild( resultado2 )
                            // console.log(Object.values(estacoes))
                        }
                    } )
                    .then( () => {
                        const metro = ( hora, minutos ) => {
                            let now = new Date()
                            let hNow = now.getHours()
                            let mNow = now.getMinutes()
                            if ( ( hora > 24 || hora < 0 || minutos < 0 || minutos > 59 ) )
                                return ['Hora inválida']

                            // Variaveis e constantes
                            const stepHours = 1
                            const startHours = 6
                            const endHours = 23
                            const resultado = []
                            const final = []

                            //Objeto principal
                            const info = {
                                ceilandia: {
                                    horas: [],
                                    minutos: [00]
                                },
                                samambaia: {
                                    horas: [],
                                    minutos: [00]
                                }
                            }

                            // Definindo horarios de funcionamento (06AM - 20h)
                            {
                                //HORA de funcionamento
                                const metroHoras = ( min, max, step ) => {
                                    for ( let i = min; i <= max; i += step ) {
                                        info.ceilandia.horas.push( i )
                                        info.samambaia.horas.push( i )
                                    }
                                    // info.ceilandia.horas.push(info.ceilandia.horas.length+2)
                                }
                                metroHoras( startHours, endHours, stepHours )

                                //MINUTOS que o metro de CEILANDIA passa
                                const CEIminutos = ( min, max, step ) => {
                                    for ( i = min; i <= max; i += step ) { info.ceilandia.minutos.push( i ) }
                                }
                                CEIminutos( 20, 60, 20 )

                                //MINUTOS que o metro de SAMAMBAIA passa
                                const SAMminutos = ( min, max, step ) => {
                                    for ( i = min; i <= max; i += step ) { info.samambaia.minutos.push( i ) }
                                }
                                SAMminutos( 10, 70, 20 )
                            }


                            // Checando que horas você chegou e que horas o metrô passa
                            if ( ( info.ceilandia.horas.includes( hora ) ) || info.samambaia.horas.includes( hora ) ) {
                                for ( i = 0; i <= info.ceilandia.minutos.length; i++ ) {
                                    if ( ( minutos <= info.ceilandia.minutos[i] ) && ( minutos > info.ceilandia.minutos[i - 1] ) )
                                        resultado.push( info.ceilandia.minutos[i] )
                                }
                                for ( i = 0; i <= info.samambaia.minutos.length; i++ ) {
                                    if ( ( minutos >= 10 && ( minutos <= info.samambaia.minutos[i] ) && ( minutos > info.samambaia.minutos[i - 1] ) ) )
                                        resultado.push( info.samambaia.minutos[i] )
                                }
                                if ( ( minutos < 10 ) && ( minutos > 0 ) ) { resultado.push( info.samambaia.minutos[1] ) }

                            }
                            let proximoTrem = info.samambaia.minutos.includes( resultado[0] ) ? "Samambaia" : "Ceilandia"

                            if (hNow > endHours) {
                                return 'METRO FECHADO'
                            }


                            if ( ( info.samambaia.horas.includes( hora ) ) && ( info.samambaia.minutos.includes( resultado[1] ) ) && ( ( resultado[1] - minutos ) != 0 ) ) {
                                final.push( `<i class="fa-solid fa-angles-right samambaia"></i>\u00A0SAMAMBAIA  \u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0 ${resultado[1] - minutos}MIN <br>` )                                
                            }
                            else if ( ( resultado[1] - minutos ) == 0 ) {
                                final.push( '<i class="fa-solid fa-angles-right samambaia"></i>\u00A0SAMAMBAIA  \u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0 PLATAFORMA <br>' )
                            }


                            if ( ( info.ceilandia.horas.includes( hora ) ) && ( info.ceilandia.minutos.includes( resultado[0] ) ) && ( ( resultado[0] - minutos ) != 0 ) ) {
                                final.push( `<i class="fa-solid fa-angles-right ceilandia"></i>\u00A0CEILÂNDIA   \u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0  ${resultado[0] - minutos}MIN <br>` )
                            }
                            else if ( ( ( resultado[0] - minutos ) == 0 ) || ( ( info.ceilandia.horas.includes( hora ) ) && ( minutos == 00 ) ) ) {
                                final.push( '<i class="fa-solid fa-angles-right ceilandia"></i> \u00A0CEILÂNDIA \u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0PLATAFORMA <br>' )
                            }



                            if ( ( resultado[0] - minutos ) < ( resultado[1] - minutos ) ) {
                                final.reverse()
                            }


                            return `${final[0]}<br>${final[1]}`


                        }



                        //INSIRA AQUI O HORÁRIO DE CHEGADA NA ESTAÇÃO NO FORMATO (HORA,MINUTO)
                        const interval = setInterval( () => {
                            let now = new Date()
                            let hourNow = now.getHours()
                            let minutesNow = now.getMinutes()
                            resultado1.innerHTML = `PRÓXIMOS TRENS <br><br> ${metro( hourNow, minutesNow )}`;
                            section.appendChild( resultado1 )
                        }, 300 );
                        console.log( resultado1 )
                    } )
            }
        } )
        document.querySelectorAll( '[mnav]' ).forEach( link => {
            const conteudo = document.getElementById( 'teste' )

            link.onclick = function ( e ) {
                e.preventDefault()

                fetch( link.getAttribute( 'mnav', {
                } ) )
                    .then( resp => resp.text() )
                    .then( html => conteudo.innerHTML = html )
            }
        } )


    </script>
</body>

</html>
